<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>在 CentOS9上安装 Kubernetes1.35集群 | starttech 的个人博客</title><meta name="author" content="starttech"><meta name="copyright" content="starttech"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="各位技术爱好者们，大家好！本文是在 CentOS 9系统上安装 Kubernetes 。在本指南中，将一步步指导你完成集群的启动和运行，从安装到配置，全程无遗漏   先决条件 在开始安装过程之前，请确保您已具备以下先决条件：  至少需要三个节点（一个主节点和两个工作节点），运行系统CentOS 9。 每个节点至少应配备 2GB 内存和 2 个 CPU 核心。 如果没有设置 DNS，则每个节点的配">
<meta property="og:type" content="article">
<meta property="og:title" content="在 CentOS9上安装 Kubernetes1.35集群">
<meta property="og:url" content="https://jsonhc.github.io/posts/1243066711/index.html">
<meta property="og:site_name" content="starttech 的个人博客">
<meta property="og:description" content="各位技术爱好者们，大家好！本文是在 CentOS 9系统上安装 Kubernetes 。在本指南中，将一步步指导你完成集群的启动和运行，从安装到配置，全程无遗漏   先决条件 在开始安装过程之前，请确保您已具备以下先决条件：  至少需要三个节点（一个主节点和两个工作节点），运行系统CentOS 9。 每个节点至少应配备 2GB 内存和 2 个 CPU 核心。 如果没有设置 DNS，则每个节点的配">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jsonhc.github.io/img/background/xiaoxin.png">
<meta property="article:published_time" content="2026-02-27T13:00:00.000Z">
<meta property="article:modified_time" content="2026-02-27T13:29:02.693Z">
<meta property="article:author" content="starttech">
<meta property="article:tag" content="随笔">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jsonhc.github.io/img/background/xiaoxin.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "在 CentOS9上安装 Kubernetes1.35集群",
  "url": "https://jsonhc.github.io/posts/1243066711/",
  "image": "https://jsonhc.github.io/img/background/xiaoxin.png",
  "datePublished": "2026-02-27T13:00:00.000Z",
  "dateModified": "2026-02-27T13:29:02.693Z",
  "author": [
    {
      "@type": "Person",
      "name": "starttech",
      "url": "https://starttech.dpdns.org"
    }
  ]
}</script><link rel="shortcut icon" href="/img/background/xiaoxin.png"><link rel="canonical" href="https://jsonhc.github.io/posts/1243066711/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="2v1UADJqpZJ5KqKWgUqA294HZa_-NdcQIohtosPH2dc"/><meta name="bing-site-auth" content="2FCD3C6000E75D57EDD2C2CED90140DC"/><link rel="manifest" href="/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/img/background/xiaoxin.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/background/xiaoxin.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/background/xiaoxin.png"/><link rel="mask-icon" href="/img/pwa/mask-icon.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 19 || hour >= 6
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":320,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#F8789B","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '在 CentOS9上安装 Kubernetes1.35集群',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4720662963303092" crossorigin="anonymous"></script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="starttech 的个人博客" type="application/atom+xml">
</head><body><div class="bg-animation" id="web_bg" style="background-image: url(/img/background/background.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/background/xiaoxin.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archive/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i><span> 页面</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archive/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i><span> 说说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-ellipsis"></i><span> 更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" href="/privacy/"><i class="fa-fw fas fa-user-shield"></i><span> 隐私政策</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/background/125931837_p0.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/background/xiaoxin.png" alt="Logo"><span class="site-name">starttech 的个人博客</span></a><a class="nav-page-title" href="/"><span class="site-name">在 CentOS9上安装 Kubernetes1.35集群</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i><span> 页面</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archive/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comment-dots"></i><span> 说说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-ellipsis"></i><span> 更多</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li><li><a class="site-page child" href="/privacy/"><i class="fa-fw fas fa-user-shield"></i><span> 隐私政策</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">在 CentOS9上安装 Kubernetes1.35集群<a class="post-edit-link" href="https://github.com/jsonhc/jsonhc.github.io/edit/main/source/_posts/在CentOS9上安装Kubernetes1.35集群.md" rel="external nofollow noreferrer" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-02-27T13:00:00.000Z" title="发表于 2026-02-27 21:00:00">2026-02-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-27T13:29:02.693Z" title="更新于 2026-02-27 21:29:02">2026-02-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>18分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;该文章距离更新时间已有&quot;,&quot;messageNext&quot;:&quot;天，内容可能已过时。&quot;,&quot;postUpdate&quot;:&quot;2026-02-27 21:29:02&quot;}" hidden></div><hr />
<p>各位技术爱好者们，大家好！本文是在 CentOS 9系统上安装 Kubernetes 。在本指南中，将一步步指导你完成集群的启动和运行，从安装到配置，全程无遗漏</p>
<hr />
<h3 id="先决条件"><a class="markdownIt-Anchor" href="#先决条件"></a> 先决条件</h3>
<p>在开始安装过程之前，请确保您已具备以下先决条件：</p>
<ul>
<li>至少需要三个节点（一个主节点和两个工作节点），运行系统CentOS 9。</li>
<li>每个节点至少应配备 2GB 内存和 2 个 CPU 核心。</li>
<li>如果没有设置 DNS，则每个节点的配置/etc/hosts文件中配置各个节点的解析</li>
</ul>
<p>本文是部署教程，所以只设置了master和node两台centos9系统的节点</p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>ip</th>
<th>内存</th>
<th>核心</th>
<th>操作系统</th>
</tr>
</thead>
<tbody>
<tr>
<td>master</td>
<td>192.168.213.30</td>
<td>16</td>
<td>4</td>
<td>centos9</td>
</tr>
<tr>
<td>worker1</td>
<td>192.168.213.31</td>
<td>16</td>
<td>4</td>
<td>centos9</td>
</tr>
<tr>
<td>在 CentOS9上安装Kubernetes集群</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="配置ip"><a class="markdownIt-Anchor" href="#配置ip"></a> 配置ip</h3>
<ul>
<li>master节点</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# nmcli connection modify <span class="string">&quot;ens160&quot;</span> ipv4.method manual ipv4.addresses 192.168.213.30/24 ipv4.gateway 192.168.213.2 ipv4.dns <span class="string">&quot;192.168.213.2&quot;</span></span><br><span class="line">[root@localhost ~]# nmcli connection up <span class="string">&quot;ens160&quot;</span></span><br><span class="line">Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)</span><br></pre></td></tr></table></figure>
<ul>
<li>worker1节点</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# nmcli connection modify <span class="string">&quot;ens160&quot;</span> ipv4.method manual ipv4.addresses 192.168.213.31/24 ipv4.gateway 192.168.213.2 ipv4.dns <span class="string">&quot;192.168.213.2&quot;</span></span><br><span class="line">[root@localhost ~]# nmcli connection up <span class="string">&quot;ens160&quot;</span></span><br><span class="line">Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/3)</span><br></pre></td></tr></table></figure>
<p>配置好ip后，设置hosts(两个节点都需要)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span> /etc/hosts</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.213.30  master</span><br><span class="line">192.168.213.31  worker1</span><br></pre></td></tr></table></figure>
<h3 id="配置主机名"><a class="markdownIt-Anchor" href="#配置主机名"></a> 配置主机名</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# hostnamectl set-hostname master</span><br><span class="line">[root@localhost ~]# hostnamectl set-hostname worker1</span><br></pre></td></tr></table></figure>
<h3 id="关闭防火墙和设置selinux两个节点都需要"><a class="markdownIt-Anchor" href="#关闭防火墙和设置selinux两个节点都需要"></a> 关闭防火墙和设置selinux(两个节点都需要)</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# systemctl stop firewalld.service</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">disable</span> firewalld.service</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/multi-user.target.wants/firewalld.service&quot;</span>.</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&quot;</span>.</span><br><span class="line">[root@master ~]# setenforce 0</span><br><span class="line">[root@master ~]# sed -i <span class="string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>
<h3 id="关闭swap两个节点都需要"><a class="markdownIt-Anchor" href="#关闭swap两个节点都需要"></a> 关闭swap(两个节点都需要)</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# sed -ri <span class="string">&#x27;s/.*swap.*/#&amp;/&#x27;</span> /etc/fstab</span><br><span class="line">[root@master ~]# swapoff -a</span><br></pre></td></tr></table></figure>
<h3 id="配置aliyun源两个节点都需要"><a class="markdownIt-Anchor" href="#配置aliyun源两个节点都需要"></a> 配置aliyun源(两个节点都需要)</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">tee</span> /etc/yum.repos.d/centos.repo &gt; /dev/null &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[baseos]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=1</span><br><span class="line">[baseos-debuginfo]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS Debuginfo - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line">[baseos-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS Source - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line">[appstream]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=1</span><br><span class="line">[appstream-debuginfo]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream Debuginfo - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line">[appstream-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream Source - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="安装内核相关的包文件两个节点都需要"><a class="markdownIt-Anchor" href="#安装内核相关的包文件两个节点都需要"></a> 安装内核相关的包文件(两个节点都需要)</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# dnf install kernel-devel-$(<span class="built_in">uname</span> -r)</span><br></pre></td></tr></table></figure>
<h3 id="启用内核模块配置桥接iptables两个节点都需要"><a class="markdownIt-Anchor" href="#启用内核模块配置桥接iptables两个节点都需要"></a> 启用内核模块配置桥接iptables(两个节点都需要)</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# modprobe br_netfilter</span><br><span class="line">[root@master ~]# modprobe ip_vs</span><br><span class="line">[root@master ~]# modprobe ip_vs_rr</span><br><span class="line">[root@master ~]# modprobe ip_vs_wrr</span><br><span class="line">[root@master ~]# modprobe ip_vs_sh</span><br><span class="line">[root@master ~]# modprobe overlay</span><br></pre></td></tr></table></figure>
<p>上面作用：加载kubernetes正常运行所必需的内核模块，通过加载这些模块，您可以确保服务器已为 Kubernetes 安装做好准备，并能有效地管理集群内的网络和负载均衡任务</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/modules-load.d/kubernetes.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">ip_vs</span></span><br><span class="line"><span class="string">ip_vs_rr</span></span><br><span class="line"><span class="string">ip_vs_wrr</span></span><br><span class="line"><span class="string">ip_vs_sh</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<p>这里是为了这些模块在系统启动时进行加载</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/kubernetes.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<ul>
<li>net.bridge.bridge-nf-call-ip6tables：使iptables能够处理桥接的 IPv6 流量</li>
<li>net.bridge.bridge-nf-call-iptables：使 iptables 能够处理桥接的 IPv4 流量</li>
<li>net.ipv4.ip_forward：启用IPv4数据包转发<br />
通过设置这些sysctl参数，可以确保系统配置正确，以支持 Kubernetes 网络需求以及集群内部的网络流量转发。这些设置对于 Kubernetes 网络组件的平稳运行至关重要</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# sysctl --system</span><br></pre></td></tr></table></figure>
<p>以上就是k8s节点系统中相关的初始化配置，接下来就是其他的配置<br />
这里还是使用docker作为k8s的容器运行，替代Containerd(两个节点都需要)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cd</span> /etc/yum.repos.d/ &amp;&amp; wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">[root@master yum.repos.d]# <span class="built_in">cd</span></span><br><span class="line">[root@master ~]# yum install docker-ce -y</span><br><span class="line">[root@master ~]# systemctl start docker</span><br><span class="line">[root@master ~]# systemctl status docker</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>
<ul>
<li>配置docker加速</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/docker/daemon.json</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;registry-mirrors&quot;: [</span></span><br><span class="line"><span class="string">     &quot;https://docker.1ms.run&quot;,</span></span><br><span class="line"><span class="string">     &quot;https://docker.aityp.com&quot;,</span></span><br><span class="line"><span class="string">     &quot;https://docker.m.daocloud.io&quot;</span></span><br><span class="line"><span class="string">     ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">systemctl daemon-reload</span></span><br><span class="line"><span class="string">systemctl restart docker</span></span><br></pre></td></tr></table></figure>
<ul>
<li>测试镜像下载</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@worker1 ~]# docker pull nginx</span><br></pre></td></tr></table></figure>
<ul>
<li>如果下载镜像还是有问题，建议docker做代理，或者离线下载好需要用到的镜像。docker代理配置：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[root@master ~]# <span class="built_in">mkdir</span> -p /etc/systemd/system/docker.service.d</span><br><span class="line">[root@master ~]# vim /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">[root@master ~]# <span class="built_in">cat</span> /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">&quot;HTTPS_PROXY=http://192.168.3.31:7897&quot;</span></span><br><span class="line">[root@master ~]# systemctl daemon-reload</span><br><span class="line">[root@master ~]# systemctl restart docker</span><br><span class="line">[root@master ~]# systemctl show --property=Environment docker</span><br><span class="line">Environment=HTTPS_PROXY=http://192.168.3.31:7897</span><br></pre></td></tr></table></figure>
<h3 id="安装cri-dockerd两个节点都需要"><a class="markdownIt-Anchor" href="#安装cri-dockerd两个节点都需要"></a> 安装cri-dockerd(两个节点都需要)</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.16/cri-dockerd-0.3.16.amd64.tgz</span><br><span class="line">[root@master ~]# tar xf cri-dockerd-0.3.16.amd64.tgz</span><br><span class="line">[root@master ~]# <span class="built_in">cp</span> cri-dockerd/cri-dockerd /usr/bin/</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> cri-docker --now</span><br><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> cri-docker.socket --now</span><br><span class="line">[root@master ~]# systemctl status cri-docker</span><br></pre></td></tr></table></figure>
<ul>
<li>上面涉及的服务cri-docker.service、cri-docker.socket，服务文件如下</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[root@master ~]# <span class="built_in">cat</span> /etc/systemd/system/cri-docker.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=CRI Interface <span class="keyword">for</span> Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.mirantis.com</span><br><span class="line">After=network-online.target firewalld.service docker.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line">Requires=cri-docker.socket</span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">ExecStart=/usr/bin/cri-dockerd --container-runtime-endpoint fd://</span><br><span class="line">ExecReload=/bin/kill -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">TimeoutSec=0</span><br><span class="line">RestartSec=2</span><br><span class="line">Restart=always</span><br><span class="line"><span class="comment"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.</span></span><br><span class="line"><span class="comment"># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span></span><br><span class="line"><span class="comment"># to make them work for either version of systemd.</span></span><br><span class="line">StartLimitBurst=3</span><br><span class="line"><span class="comment"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span></span><br><span class="line"><span class="comment"># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span></span><br><span class="line"><span class="comment"># this option work for either version of systemd.</span></span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"><span class="comment"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span><br><span class="line"><span class="comment"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"><span class="comment"># Comment TasksMax if your systemd version does not support it.</span></span><br><span class="line"><span class="comment"># Only systemd 226 and above support this option.</span></span><br><span class="line">TasksMax=infinity</span><br><span class="line">Delegate=<span class="built_in">yes</span></span><br><span class="line">KillMode=process</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span> /etc/systemd/system/cri-docker.socket</span><br><span class="line">[Unit]</span><br><span class="line">Description=CRI Docker Socket <span class="keyword">for</span> the API</span><br><span class="line">PartOf=cri-docker.service</span><br><span class="line">[Socket]</span><br><span class="line">ListenStream=%t/cri-dockerd.sock</span><br><span class="line">SocketMode=0660</span><br><span class="line">SocketUser=root</span><br><span class="line">SocketGroup=docker</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sockets.target</span><br></pre></td></tr></table></figure>
<p>两个节点都验证cri-dockerd服务正常后，就可以继续接下来的操作了</p>
<h3 id="安装kubernetes组件两个节点都需要"><a class="markdownIt-Anchor" href="#安装kubernetes组件两个节点都需要"></a> 安装kubernetes组件(两个节点都需要)</h3>
<ul>
<li>配置kubernetes1.35版本仓库</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.35/rpm/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.35/rpm/repodata/repomd.xml.key</span></span><br><span class="line"><span class="string">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>
<ul>
<li>安装 Kubernetes 软件包</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br></pre></td></tr></table></figure>
<p>该–disableexcludes=kubernetes标志确保在安装过程中不会排除 Kubernetes 存储库中的软件包</p>
<ul>
<li>启动并启用 kubelet 服务</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# systemctl <span class="built_in">enable</span> --now kubelet.service</span><br></pre></td></tr></table></figure>
<h3 id="初始化kubernetes控制平面master节点操作"><a class="markdownIt-Anchor" href="#初始化kubernetes控制平面master节点操作"></a> 初始化Kubernetes控制平面(master节点操作)</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubeadm init --apiserver-advertise-address=192.168.213.30 --image-repository registry.aliyuncs.com/google_containers --service-cidr=10.96.0.0/16 --pod-network-cidr=10.244.0.0/16 --cri-socket unix:///var/run/cri-dockerd.sock</span><br></pre></td></tr></table></figure>
<p>初始化过程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubeadm init --apiserver-advertise-address=192.168.213.30 --image-repository registry.aliyuncs.com/google_containers --service-cidr=10.96.0.0/16 --pod-network-cidr=10.244.0.0/16 --cri-socket unix:///var/run/cri-dockerd.sock</span><br><span class="line">[init] Using Kubernetes version: v1.35.0</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">        [WARNING ContainerRuntimeVersion]: You must update your container runtime to a version that supports the CRI method RuntimeConfig. Falling back to using cgroupDriver from kubelet config will be removed <span class="keyword">in</span> 1.36. For more information, see https://git.k8s.io/enhancements/keps/sig-node/4033-group-driver-detection-over-cri</span><br><span class="line">        [WARNING SystemVerification]: kernel release 5.14.0-665.el9.x86_64 is unsupported. Supported LTS versions from the 5.x series are 5.4, 5.10 and 5.15. Any 6.x version is also supported. For cgroups v2 support, the recommended version is 5.10 or newer</span><br><span class="line">        [WARNING Hostname]: hostname <span class="string">&quot;master&quot;</span> could not be reached</span><br><span class="line">        [WARNING Hostname]: hostname <span class="string">&quot;master&quot;</span>: lookup master on 192.168.213.2:53: no such host</span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action beforehand using <span class="string">&#x27;kubeadm config images pull&#x27;</span></span><br><span class="line">W0131 22:35:18.560702   59468 checks.go:906] detected that the sandbox image <span class="string">&quot;registry.k8s.io/pause:3.9&quot;</span> of the container runtime is inconsistent with that used by kubeadm. It is recommended to use <span class="string">&quot;registry.aliyuncs.com/google_containers/pause:3.10.1&quot;</span> as the CRI sandbox image.</span><br><span class="line">[certs] Using certificateDir folder <span class="string">&quot;/etc/kubernetes/pki&quot;</span></span><br><span class="line">[certs] Generating <span class="string">&quot;ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver&quot;</span> certificate and key</span><br><span class="line">[certs] apiserver serving cert is signed <span class="keyword">for</span> DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local master] and IPs [10.96.0.1 192.168.213.30]</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-kubelet-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/server&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/server serving cert is signed <span class="keyword">for</span> DNS names [localhost master] and IPs [192.168.213.30 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/peer&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/peer serving cert is signed <span class="keyword">for</span> DNS names [localhost master] and IPs [192.168.213.30 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/healthcheck-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-etcd-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;sa&quot;</span> key and public key</span><br><span class="line">[kubeconfig] Using kubeconfig folder <span class="string">&quot;/etc/kubernetes&quot;</span></span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;super-admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;kubelet.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;controller-manager.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;scheduler.conf&quot;</span> kubeconfig file</span><br><span class="line">[etcd] Creating static Pod manifest <span class="keyword">for</span> <span class="built_in">local</span> etcd <span class="keyword">in</span> <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Using manifest folder <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-apiserver&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-controller-manager&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest <span class="keyword">for</span> <span class="string">&quot;kube-scheduler&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/instance-config.yaml&quot;</span></span><br><span class="line">[patches] Applied patch of <span class="built_in">type</span> <span class="string">&quot;application/strategic-merge-patch+json&quot;</span> to target <span class="string">&quot;kubeletconfiguration&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[wait-control-plane] Waiting <span class="keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[kubelet-check] Waiting <span class="keyword">for</span> a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s</span><br><span class="line">[kubelet-check] The kubelet is healthy after 1.002242613s</span><br><span class="line">[control-plane-check] Waiting <span class="keyword">for</span> healthy control plane components. This can take up to 4m0s</span><br><span class="line">[control-plane-check] Checking kube-apiserver at https://192.168.213.30:6443/livez</span><br><span class="line">[control-plane-check] Checking kube-controller-manager at https://127.0.0.1:10257/healthz</span><br><span class="line">[control-plane-check] Checking kube-scheduler at https://127.0.0.1:10259/livez</span><br><span class="line">[control-plane-check] kube-controller-manager is healthy after 8.506861505s</span><br><span class="line">[control-plane-check] kube-scheduler is healthy after 9.943662123s</span><br><span class="line">[control-plane-check] kube-apiserver is healthy after 12.004015281s</span><br><span class="line">[upload-config] Storing the configuration used <span class="keyword">in</span> ConfigMap <span class="string">&quot;kubeadm-config&quot;</span> <span class="keyword">in</span> the <span class="string">&quot;kube-system&quot;</span> Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap <span class="string">&quot;kubelet-config&quot;</span> <span class="keyword">in</span> namespace kube-system with the configuration <span class="keyword">for</span> the kubelets <span class="keyword">in</span> the cluster</span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node master as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span><br><span class="line">[mark-control-plane] Marking the node master as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: eydjwt.nrde0uu9mslzfc13</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="keyword">in</span> order <span class="keyword">for</span> nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] Configured RBAC rules to allow certificate rotation <span class="keyword">for</span> all node client certificates <span class="keyword">in</span> the cluster</span><br><span class="line">[bootstrap-token] Creating the <span class="string">&quot;cluster-info&quot;</span> ConfigMap <span class="keyword">in</span> the <span class="string">&quot;kube-public&quot;</span> namespace</span><br><span class="line">[kubelet-finalize] Updating <span class="string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line">    <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">    <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">    <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">Alternatively, <span class="keyword">if</span> you are the root user, you can run:</span><br><span class="line">    <span class="built_in">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">    https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.213.30:6443 --token eydjwt.nrde0uu9mslzfc13 \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:288c17b1953041849daa0fd2f2c6ddf3d717c4ae994afbf555eef880e036228b</span><br></pre></td></tr></table></figure>
<p>没有报错，执行结果很丝滑，按照提示做相关操作</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">[root@master ~]# <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">[root@master ~]# <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure>
<p>查看node状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME     STATUS     ROLES           AGE     VERSION</span><br><span class="line">master   NotReady   control-plane   2m41s   v1.35.0</span><br></pre></td></tr></table></figure>
<p>master节点没问题后，加入工作节点worker1，通过提示的命令进行操作</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@worker1 ~]# kubeadm <span class="built_in">join</span> 192.168.213.30:6443 --token eydjwt.nrde0uu9mslzfc13 --discovery-token-ca-cert-hash sha256:288c17b1953041849daa0fd2f2c6ddf3d717c4ae994afbf555eef880e036228b --cri-socket unix:///var/run/cri-dockerd.sock</span><br></pre></td></tr></table></figure>
<p>查看加入的worker1节点：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME      STATUS     ROLES           AGE   VERSION</span><br><span class="line">master    NotReady   control-plane   26m   v1.35.0</span><br><span class="line">worker1   NotReady   &lt;none&gt;          35s   v1.35.0</span><br></pre></td></tr></table></figure>
<h3 id="安装网络插件calico"><a class="markdownIt-Anchor" href="#安装网络插件calico"></a> 安装网络插件calico</h3>
<ul>
<li>实现集群中各个 Pod 之间的联网，为 Calico 部署 Tigera Operator</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# wget https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/tigera-operator.yaml</span><br><span class="line">[root@master ~]# kubectl create -f tigera-operator.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li>下载自定义 Calico 资源清单</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# wget https://raw.githubusercontent.com/projectcalico/calico/v3.26.1/manifests/custom-resources.yaml</span><br><span class="line">[root@master ~]# sed -i <span class="string">&#x27;s/cidr: 192\.168\.0\.0\/16/cidr: 10.244.0.0\/16/g&#x27;</span> custom-resources.yaml</span><br></pre></td></tr></table></figure>
<ul>
<li>上面pod子网的修改是和之前kubeadm init初始化一致的</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl create -f custom-resources.yaml</span><br><span class="line">installation.operator.tigera.io/default created</span><br><span class="line">apiserver.operator.tigera.io/default created</span><br></pre></td></tr></table></figure>
<p>验证工作节点</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl get nodes</span><br><span class="line">NAME      STATUS   ROLES           AGE   VERSION</span><br><span class="line">master    Ready    control-plane   37m   v1.35.0</span><br><span class="line">worker1   Ready    &lt;none&gt;          12m   v1.35.0</span><br></pre></td></tr></table></figure>
<p>至此kubernetes1.35集群安装成功,创建一个nginx应用进行测试</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# <span class="built_in">cat</span> nginx-deploy.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">    name: nginx-deployment</span><br><span class="line">    labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">    replicas: 1</span><br><span class="line">    selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">        app: nginx</span><br><span class="line">    template:</span><br><span class="line">    metadata:</span><br><span class="line">        labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">        containers:</span><br><span class="line">        - name: nginx</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>
<p>然后进行部署</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl create -f nginx-deploy.yaml</span><br></pre></td></tr></table></figure>
<p>查看部署的nginx的状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod</span><br><span class="line">NAME                                READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deployment-59f86b59ff-hm8d5   1/1     Running   0          32s</span><br></pre></td></tr></table></figure>
<p>将部署的应用暴露给外部网络</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[root@master ~]# <span class="built_in">cat</span> nginx-svc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">    name: nginx-service</span><br><span class="line">spec:</span><br><span class="line">    selector:</span><br><span class="line">    app: nginx</span><br><span class="line">    ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">        port: 80</span><br><span class="line">        targetPort: 80</span><br><span class="line">    <span class="built_in">type</span>: NodePort</span><br><span class="line">[root@master ~]# kubectl apply -f nginx-svc.yaml</span><br></pre></td></tr></table></figure>
<p>查询服务状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl get svc</span><br><span class="line">NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes      ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP        43m</span><br><span class="line">nginx-service   NodePort    10.96.74.125   &lt;none&gt;        80:32694/TCP   4s</span><br></pre></td></tr></table></figure>
<p>通过nodePort暴露的32694端口进行访问<a target="_blank" rel="noopener external nofollow noreferrer" href="http://192.168.213.30:32694">http://192.168.213.30:32694</a></p>
<p>本指南介绍了在 CentOS 9系统上安装 Kubernetes 的基本步骤</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://starttech.dpdns.org">starttech</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://jsonhc.github.io/posts/1243066711/">https://jsonhc.github.io/posts/1243066711/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://jsonhc.github.io" target="_blank">starttech 的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%9A%8F%E7%AC%94/">随笔</a></div><div class="post-share"><div class="social-share" data-image="/img/background/xiaoxin.png" data-sites="facebook,twitter,wechat,weibo,qq,qzone,linkedin"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>你的支持是我更新的最大动力！</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/background/sponsor/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/background/sponsor/wechat.png" alt="微信 WeChat"/></a><div class="post-qr-code-desc">微信 WeChat</div></li><li class="reward-item"><a href="/img/background/sponsor/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/background/sponsor/alipay.png" alt="支付宝 Alipay"/></a><div class="post-qr-code-desc">支付宝 Alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/posts/1243066711/" title="install microk8s on centos9"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">install microk8s on centos9</div></div><div class="info-2"><div class="info-item-1"> install microk8s on centos9  配置aliyun仓库 tee /etc/yum.repos.d/centos.repo &gt; /dev/null &lt;&lt; &#x27;EOF&#x27;[baseos]name=CentOS Stream $releasever - BaseOS - mirrors.aliyun.combaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os/gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficialenabled=1[baseos-debuginfo]name=CentOS Stream $releasever - BaseOS Debuginfo - mirrors.aliyun.combaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/debug...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/1243066710/" title="install k3s on centos9"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-26</div><div class="info-item-2">install k3s on centos9</div></div><div class="info-2"><div class="info-item-1"> install k3s on centos9  配置aliyun仓库 tee /etc/yum.repos.d/centos.repo &gt; /dev/null &lt;&lt; &#x27;EOF&#x27;[baseos]name=CentOS Stream $releasever - BaseOS - mirrors.aliyun.combaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os/gpgcheck=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficialenabled=1[baseos-debuginfo]name=CentOS Stream $releasever - BaseOS Debuginfo - mirrors.aliyun.combaseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/debug/tree...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/background/xiaoxin.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">starttech</div><div class="author-info-description">一起成长，梦想自由</div><div class="site-data"><a href="/archive/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">1</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><p>一起成长，梦想自由</strong></p>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E5%86%B3%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text"> 先决条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEip"><span class="toc-number">2.</span> <span class="toc-text"> 配置ip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">3.</span> <span class="toc-text"> 配置主机名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8C%E8%AE%BE%E7%BD%AEselinux%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E9%9C%80%E8%A6%81"><span class="toc-number">4.</span> <span class="toc-text"> 关闭防火墙和设置selinux(两个节点都需要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%97%ADswap%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E9%9C%80%E8%A6%81"><span class="toc-number">5.</span> <span class="toc-text"> 关闭swap(两个节点都需要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEaliyun%E6%BA%90%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E9%9C%80%E8%A6%81"><span class="toc-number">6.</span> <span class="toc-text"> 配置aliyun源(两个节点都需要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%86%85%E6%A0%B8%E7%9B%B8%E5%85%B3%E7%9A%84%E5%8C%85%E6%96%87%E4%BB%B6%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E9%9C%80%E8%A6%81"><span class="toc-number">7.</span> <span class="toc-text"> 安装内核相关的包文件(两个节点都需要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E9%85%8D%E7%BD%AE%E6%A1%A5%E6%8E%A5iptables%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E9%9C%80%E8%A6%81"><span class="toc-number">8.</span> <span class="toc-text"> 启用内核模块配置桥接iptables(两个节点都需要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85cri-dockerd%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E9%9C%80%E8%A6%81"><span class="toc-number">9.</span> <span class="toc-text"> 安装cri-dockerd(两个节点都需要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85kubernetes%E7%BB%84%E4%BB%B6%E4%B8%A4%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E9%9C%80%E8%A6%81"><span class="toc-number">10.</span> <span class="toc-text"> 安装kubernetes组件(两个节点都需要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96kubernetes%E6%8E%A7%E5%88%B6%E5%B9%B3%E9%9D%A2master%E8%8A%82%E7%82%B9%E6%93%8D%E4%BD%9C"><span class="toc-number">11.</span> <span class="toc-text"> 初始化Kubernetes控制平面(master节点操作)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6calico"><span class="toc-number">12.</span> <span class="toc-text"> 安装网络插件calico</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/1243066711/" title="在 CentOS9上安装 Kubernetes1.35集群">在 CentOS9上安装 Kubernetes1.35集群</a><time datetime="2026-02-27T13:00:00.000Z" title="发表于 2026-02-27 21:00:00">2026-02-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/1243066710/" title="install k3s on centos9">install k3s on centos9</a><time datetime="2026-02-25T16:00:00.000Z" title="发表于 2026-02-26 00:00:00">2026-02-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/1243066711/" title="install microk8s on centos9">install microk8s on centos9</a><time datetime="2026-02-25T16:00:00.000Z" title="发表于 2026-02-26 00:00:00">2026-02-26</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By starttech</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = {"requiredMeta":["nick","mail"],"reaction":true,"emoji":["https://unpkg.com/@waline/emojis@1.2.0/bmoji","https://unpkg.com/@waline/emojis@1.1.0/weibo","https://unpkg.com/@waline/emojis@1.2.0/alus","https://unpkg.com/@waline/emojis@1.1.0/bilibili","https://unpkg.com/@waline/emojis@1.2.0/qq","https://unpkg.com/@waline/emojis@1.2.0/tieba","https://unpkg.com/@waline/emojis@1.1.0/tw-emoji","https://unpkg.com/@waline/emojis@1.4.0/hoyoverse-hi3","https://emoji.shojo.cn/bili/webp/乖巧宝宝","https://emoji.shojo.cn/bili/webp/乖巧宝宝%20清凉一夏","https://emoji.shojo.cn/bili/webp/原神","https://emoji.shojo.cn/bili/webp/原神-须弥","https://emoji.shojo.cn/bili/webp/原神·巡林奇遇","https://emoji.shojo.cn/bili/webp/崩坏：星穹铁道","https://emoji.shojo.cn/bili/webp/崩坏3","https://emoji.shojo.cn/bili/webp/崩坏3·光辉矢愿","https://emoji.shojo.cn/bili/webp/崩坏3·天穹流星","https://emoji.shojo.cn/bili/webp/崩坏3·终焉归始","https://emoji.shojo.cn/bili/webp/崩坏3·雷鸣彻空","https://emoji.shojo.cn/bili/webp/崩坏学园2","https://emoji.shojo.cn/bili/webp/明日方舟","https://emoji.shojo.cn/bili/webp/明日方舟音律联觉","https://emoji.shojo.cn/bili/webp/明日方舟·音律联觉-灯下定影","https://emoji.shojo.cn/bili/webp/我的世界","https://emoji.shojo.cn/bili/webp/tv_小电视_动图","https://emoji.shojo.cn/bili/webp/罗小黑战记","https://emoji.shojo.cn/bili/webp/2233娘"],"locale":{"lang":"zh-CN","placeholder":"说点什么吧（昵称和邮箱为必填项。为了你能及时收到相关回复的邮件通知，请确保邮箱的正确性！）"}}

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://comment.starttech.dpdns.org',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      comment: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !true) {
    if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章 Search articles" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>