<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <author>
    <name>starttech</name>
  </author>
  <generator uri="https://hexo.io/">Hexo</generator>
  <id>https://jsonhc.github.io/</id>
  <link href="https://jsonhc.github.io/" rel="alternate"/>
  <link href="https://jsonhc.github.io/atom.xml" rel="self"/>
  <rights>All rights reserved 2026, starttech</rights>
  <subtitle>一起成长</subtitle>
  <title>starttech 的个人博客</title>
  <updated>2026-02-26T15:46:04.710Z</updated>
  <entry>
    <author>
      <name>starttech</name>
    </author>
    <category term="随笔" scheme="https://jsonhc.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    <category term="随笔" scheme="https://jsonhc.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    <content>
      <![CDATA[<h1 id="install-microk8s-on-centos9"><a class="markdownIt-Anchor" href="#install-microk8s-on-centos9"></a> install microk8s on centos9</h1><h3 id="配置aliyun仓库"><a class="markdownIt-Anchor" href="#配置aliyun仓库"></a> 配置aliyun仓库</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">tee</span> /etc/yum.repos.d/centos.repo &gt; /dev/null &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[baseos]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[baseos-debuginfo]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS Debuginfo - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - BaseOS Source - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[appstream-debuginfo]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream Debuginfo - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=CentOS Stream <span class="variable">$releasever</span> - AppStream Source - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="配置ip"><a class="markdownIt-Anchor" href="#配置ip"></a> 配置ip</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmcli connection modify <span class="string">&quot;ens160&quot;</span> ipv4.method manual ipv4.addresses 192.168.213.110/24 ipv4.gateway 192.168.213.2 ipv4.dns <span class="string">&quot;192.168.213.2&quot;</span></span><br><span class="line">nmcli connection up <span class="string">&quot;ens160&quot;</span></span><br></pre></td></tr></table></figure><h3 id="系统初始化"><a class="markdownIt-Anchor" href="#系统初始化"></a> 系统初始化</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# systemctl stop firewalld.service</span><br><span class="line">[root@localhost ~]# systemctl <span class="built_in">disable</span> firewalld.service</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/multi-user.target.wants/firewalld.service&quot;</span>.</span><br><span class="line">Removed <span class="string">&quot;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&quot;</span>.</span><br><span class="line">[root@localhost ~]# setenforce 0</span><br><span class="line">[root@localhost ~]# sed -i <span class="string">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span> /etc/selinux/config</span><br><span class="line">[root@localhost ~]#</span><br><span class="line">[root@localhost ~]#</span><br><span class="line">[root@localhost ~]# modprobe ip_tables</span><br><span class="line">[root@localhost ~]# modprobe ip_conntrack</span><br><span class="line">[root@localhost ~]# modprobe iptable_filter</span><br><span class="line">[root@localhost ~]# modprobe ipt_state</span><br></pre></td></tr></table></figure><h3 id="使用snap安装microk8s"><a class="markdownIt-Anchor" href="#使用snap安装microk8s"></a> 使用snap安装microk8s</h3><ul><li>安装snap</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# yum install epel-release</span><br><span class="line">[root@localhost ~]# yum install snapd</span><br><span class="line">[root@localhost ~]# systemctl <span class="built_in">enable</span> --now snapd.socket</span><br><span class="line">[root@localhost ~]# <span class="built_in">ln</span> -s /var/lib/snapd/snap /snap</span><br></pre></td></tr></table></figure><ul><li>安装microk8s</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# snap install microk8s --classic</span><br><span class="line">[root@localhost ~]# snap install microk8s --classic</span><br><span class="line">2026-01-21T21:59:26+08:00 INFO Waiting <span class="keyword">for</span> automatic snapd restart...</span><br><span class="line">Warning: /var/lib/snapd/snap/bin was not found <span class="keyword">in</span> your <span class="variable">$PATH</span>. If you<span class="string">&#x27;ve not restarted your session</span></span><br><span class="line"><span class="string">         since you installed snapd, try doing that. Please see https://forum.snapcraft.io/t/9469</span></span><br><span class="line"><span class="string">         for more details.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">microk8s (1.32/stable) v1.32.9 from Canonical✓ installed</span></span><br></pre></td></tr></table></figure><ul><li>MicroK8s 会创建一个用户组，以便无缝使用需要管理员权限的命令。要将当前用户添加到该用户组并获得对 .kube 缓存目录的访问权限</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# usermod -a -G microk8s <span class="variable">$USER</span></span><br><span class="line">[root@localhost ~]# <span class="built_in">mkdir</span> -p ~/.kube</span><br><span class="line">[root@localhost ~]# <span class="built_in">chmod</span> 0700 ~/.kube</span><br><span class="line">[root@localhost ~]# su - <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><ul><li>检查microk8s状态</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# microk8s status</span><br><span class="line">[root@localhost ~]# microk8s kubectl get pod -A</span><br><span class="line">[root@localhost ~]# microk8s kubectl get nodes</span><br></pre></td></tr></table></figure><p><img src="/img/article/1.png" alt="1" /></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# journalctl -u snap.microk8s.daemon-kubelite -n 100 -f</span><br><span class="line">[root@localhost ~]# systemctl status snap.microk8s.daemon-containerd</span><br></pre></td></tr></table></figure><p><a href="http://xn--registry-t39lj4eo5wwv6hf35bi1q.k8s.io/pause:3.10%E9%95%9C%E5%83%8F%E5%A4%B1%E8%B4%A5%EF%BC%8C%E7%94%B1systemctl">可以看见下载registry.k8s.io/pause:3.10镜像失败，由systemctl</a> status snap.microk8s.daemon-containerd命令找到容器加速配置<br />/var/snap/microk8s/current/args/containerd-template.toml</p><ul><li>为microk8s配置镜像源加速</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# ll /var/snap/microk8s/current/args/certs.d/</span><br><span class="line">[root@localhost ~]# <span class="built_in">mkdir</span> -p /var/snap/microk8s/current/args/certs.d/registry.k8s.io</span><br><span class="line">[root@localhost ~]# <span class="built_in">cat</span> /var/snap/microk8s/current/args/certs.d/registry.k8s.io/hosts.toml</span><br><span class="line">server = <span class="string">&quot;https://registry.k8s.io&quot;</span></span><br><span class="line"></span><br><span class="line">[host.<span class="string">&quot;https://k8s.m.daocloud.io&quot;</span>]</span><br><span class="line">  capabilities = [<span class="string">&quot;pull&quot;</span>, <span class="string">&quot;resolve&quot;</span>]</span><br><span class="line">  skip_verify = <span class="literal">false</span></span><br><span class="line">[host.<span class="string">&quot;https://mirror.azure.cn&quot;</span>]</span><br><span class="line">  capabilities = [<span class="string">&quot;pull&quot;</span>, <span class="string">&quot;resolve&quot;</span>]</span><br><span class="line">  skip_verify = <span class="literal">false</span></span><br><span class="line">[host.<span class="string">&quot;https://registry-1.docker.io&quot;</span>]</span><br><span class="line">  capabilities = [<span class="string">&quot;pull&quot;</span>, <span class="string">&quot;resolve&quot;</span>]</span><br><span class="line">  skip_verify = <span class="literal">false</span></span><br><span class="line">[root@localhost ~]# <span class="built_in">cat</span> /var/snap/microk8s/current/args/certs.d/docker.io/hosts.toml</span><br><span class="line">server = <span class="string">&quot;https://docker.io&quot;</span></span><br><span class="line"></span><br><span class="line">[host.<span class="string">&quot;https://docker.1ms.run&quot;</span>]</span><br><span class="line">  capabilities = [<span class="string">&quot;pull&quot;</span>, <span class="string">&quot;resolve&quot;</span>]</span><br><span class="line">[root@localhost ~]# snap restart microk8s</span><br></pre></td></tr></table></figure><ul><li>查看下载的镜像：</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# microk8s ctr images <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><ul><li>microk8s状态：</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# microk8s kubectl get pod -A</span><br><span class="line">NAMESPACE     NAME                                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   calico-kube-controllers-5947598c79-92cff   1/1     Running   0          12m</span><br><span class="line">kube-system   calico-node-k2qsr                          1/1     Running   0          12m</span><br><span class="line">kube-system   coredns-79b94494c7-jl6rk                   1/1     Running   0          12m</span><br><span class="line">[root@localhost ~]# microk8s kubectl get nodes</span><br><span class="line">NAME                    STATUS   ROLES    AGE   VERSION</span><br><span class="line">localhost.localdomain   Ready    &lt;none&gt;   12m   v1.32.9</span><br></pre></td></tr></table></figure><ul><li>启用基础插件</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# microk8s <span class="built_in">enable</span> dns</span><br><span class="line">Infer repository core <span class="keyword">for</span> addon dns</span><br><span class="line">Addon core/dns is already enabled</span><br><span class="line">[root@localhost ~]# microk8s <span class="built_in">enable</span> hostpath-storage</span><br><span class="line">Infer repository core <span class="keyword">for</span> addon hostpath-storage</span><br><span class="line">Enabling default storage class.</span><br><span class="line">WARNING: Hostpath storage is not suitable <span class="keyword">for</span> production environments.</span><br><span class="line">         A hostpath volume can grow beyond the size <span class="built_in">limit</span> <span class="built_in">set</span> <span class="keyword">in</span> the volume claim manifest.</span><br><span class="line"></span><br><span class="line">deployment.apps/hostpath-provisioner created</span><br><span class="line">storageclass.storage.k8s.io/microk8s-hostpath created</span><br><span class="line">serviceaccount/microk8s-hostpath created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/microk8s-hostpath created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/microk8s-hostpath created</span><br><span class="line">Storage will be available soon.</span><br><span class="line">[root@localhost ~]# microk8s kubectl get sc</span><br><span class="line">NAME                          PROVISIONER            RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">microk8s-hostpath (default)   microk8s.io/hostpath   Delete          WaitForFirstConsumer   <span class="literal">false</span>                  5s</span><br></pre></td></tr></table></figure><p>更多插件：<a href="https://canonical.com/microk8s/docs/addons">https://canonical.com/microk8s/docs/addons</a></p><h3 id="microk8s集群添加worker节点"><a class="markdownIt-Anchor" href="#microk8s集群添加worker节点"></a> microk8s集群添加Worker节点</h3><ul><li>新增worker节点并安装好microk8s集群,版本需要一致</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# microk8s kubectl get nodes</span><br><span class="line">NAME                    STATUS   ROLES    AGE   VERSION</span><br><span class="line">localhost.localdomain   Ready    &lt;none&gt;   90m   v1.32.9</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# snap install microk8s --classic --channel=1.32</span><br><span class="line">2026-01-21T23:43:08+08:00 INFO Waiting <span class="keyword">for</span> automatic snapd restart...</span><br><span class="line">Warning: /var/lib/snapd/snap/bin was not found <span class="keyword">in</span> your <span class="variable">$PATH</span>. If you<span class="string">&#x27;ve not restarted your session</span></span><br><span class="line"><span class="string">         since you installed snapd, try doing that. Please see https://forum.snapcraft.io/t/9469</span></span><br><span class="line"><span class="string">         for more details.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">microk8s (1.32/stable) v1.32.9 from Canonical✓ installed</span></span><br><span class="line"><span class="string">[root@localhost ~]# hostnamectl set-hostname microk8s-worker</span></span><br><span class="line"><span class="string">[root@microk8s-worker ~]# microk8s kubectl get nodes</span></span><br><span class="line"><span class="string">NAME                    STATUS     ROLES    AGE     VERSION</span></span><br><span class="line"><span class="string">localhost.localdomain   NotReady   &lt;none&gt;   2m41s   v1.32.9</span></span><br></pre></td></tr></table></figure><ul><li>worker节点配置镜像加速，参考上面</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@microk8s-worker ~]# microk8s kubectl get nodes</span><br><span class="line">NAME                    STATUS     ROLES    AGE     VERSION</span><br><span class="line">localhost.localdomain   NotReady   &lt;none&gt;   7m34s   v1.32.9</span><br><span class="line">microk8s-worker         Ready      &lt;none&gt;   2m44s   v1.32.9</span><br><span class="line">[root@microk8s-worker ~]# microk8s remove-node localhost.localdomain</span><br><span class="line">[root@microk8s-worker ~]# microk8s kubectl get nodes</span><br><span class="line">NAME              STATUS   ROLES    AGE     VERSION</span><br><span class="line">microk8s-worker   Ready    &lt;none&gt;   2m55s   v1.32.9</span><br><span class="line">[root@microk8s-worker ~]# microk8s kubectl get pod -A</span><br><span class="line">NAMESPACE     NAME                                       READY   STATUS     RESTARTS   AGE</span><br><span class="line">kube-system   calico-kube-controllers-5947598c79-zp6wc   1/1     Running    0          7m41s</span><br><span class="line">kube-system   calico-node-h2rzw                          1/1     Running    0          116s</span><br><span class="line">kube-system   coredns-79b94494c7-zpd9n                   1/1     Running    0          7m41s</span><br></pre></td></tr></table></figure><ul><li>从192.168.213.110上添加worker节点192.168.213.111<br />获取token添加方式：</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# microk8s add-node</span><br><span class="line">From the node you wish to <span class="built_in">join</span> to this cluster, run the following:</span><br><span class="line">microk8s <span class="built_in">join</span> 192.168.213.110:25000/3261736fb5043b8367253a69ee907dc5/7f32c8813166</span><br><span class="line"></span><br><span class="line">Use the <span class="string">&#x27;--worker&#x27;</span> flag to <span class="built_in">join</span> a node as a worker not running the control plane, eg:</span><br><span class="line">microk8s <span class="built_in">join</span> 192.168.213.110:25000/3261736fb5043b8367253a69ee907dc5/7f32c8813166 --worker</span><br><span class="line"></span><br><span class="line">If the node you are adding is not reachable through the default interface you can use one of the following:</span><br><span class="line">microk8s <span class="built_in">join</span> 192.168.213.110:25000/3261736fb5043b8367253a69ee907dc5/7f32c8813166</span><br></pre></td></tr></table></figure><ul><li>在worker节点上操作如下：</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@microk8s-worker ~]# microk8s kubectl get nodes</span><br><span class="line">NAME              STATUS   ROLES    AGE    VERSION</span><br><span class="line">microk8s-worker   Ready    &lt;none&gt;   4m3s   v1.32.9</span><br><span class="line">[root@microk8s-worker ~]# microk8s <span class="built_in">join</span> 192.168.213.110:25000/3261736fb5043b8367253a69ee907dc5/7f32c8813166 --worker</span><br><span class="line">Contacting cluster at 192.168.213.110</span><br><span class="line"></span><br><span class="line">The node has joined the cluster and will appear <span class="keyword">in</span> the nodes list <span class="keyword">in</span> a few seconds.</span><br><span class="line"></span><br><span class="line">This worker node gets automatically configured with the API server endpoints.</span><br><span class="line">If the API servers are behind a loadbalancer please <span class="built_in">set</span> the <span class="string">&#x27;--refresh-interval&#x27;</span> to <span class="string">&#x27;0s&#x27;</span> <span class="keyword">in</span>:</span><br><span class="line">    /var/snap/microk8s/current/args/apiserver-proxy</span><br><span class="line">and replace the API server endpoints with the one provided by the loadbalancer <span class="keyword">in</span>:</span><br><span class="line">    /var/snap/microk8s/current/args/traefik/provider.yaml</span><br><span class="line"></span><br><span class="line">Successfully joined the cluster.</span><br></pre></td></tr></table></figure><p>添加成功后，在110节点上查询</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# microk8s kubectl get nodes</span><br><span class="line">NAME                    STATUS   ROLES    AGE    VERSION</span><br><span class="line">localhost.localdomain   Ready    &lt;none&gt;   138m   v1.32.9</span><br><span class="line">microk8s-worker         Ready    &lt;none&gt;   21s    v1.32.9</span><br></pre></td></tr></table></figure><p><img src="/img/article/2.png" alt="2" /></p><p>特别注意：在 MicroK8s 集群中，所有集群级别的管理操作，都需要在 Master 节点（即控制平面节点）上执行。Worker 节点的职责是运行工作负载，而不是管理集群本身<br />所以启用插件只需要在master节点操作就行，如果master事先已经启用了某些插件，那么加入的worker后就不需要再次启用了</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# microk8s <span class="built_in">enable</span> dns</span><br><span class="line">Infer repository core <span class="keyword">for</span> addon dns</span><br><span class="line">Addon core/dns is already enabled</span><br><span class="line">[root@localhost ~]# microk8s <span class="built_in">enable</span> hostpath-storage</span><br><span class="line">Infer repository core <span class="keyword">for</span> addon hostpath-storage</span><br><span class="line">Addon core/hostpath-storage is already enabled</span><br></pre></td></tr></table></figure>]]>
    </content>
    <id>https://jsonhc.github.io/posts/1243066711/</id>
    <link href="https://jsonhc.github.io/posts/1243066711/"/>
    <published>2026-02-25T16:00:00.000Z</published>
    <summary>
      <![CDATA[<h1 id="install-microk8s-on-centos9"><a class="markdownIt-Anchor" href="#install-microk8s-on-centos9"></a> install microk8s on centos9</h1>]]>
    </summary>
    <title>install microk8s on centos9</title>
    <updated>2026-02-26T15:46:04.710Z</updated>
  </entry>
  <entry>
    <author>
      <name>starttech</name>
    </author>
    <category term="随笔" scheme="https://jsonhc.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    <category term="随笔" scheme="https://jsonhc.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    <content>
      <![CDATA[<h1 id="install-k3s-on-centos9"><a class="markdownIt-Anchor" href="#install-k3s-on-centos9"></a> install k3s on centos9</h1><h3 id="配置aliyun仓库"><a class="markdownIt-Anchor" href="#配置aliyun仓库"></a> 配置aliyun仓库</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tee /etc/yum.repos.d/centos.repo &gt; /dev/null &lt;&lt; &#x27;EOF&#x27;</span><br><span class="line">[baseos]</span><br><span class="line">name=CentOS Stream $releasever - BaseOS - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[baseos-debuginfo]</span><br><span class="line">name=CentOS Stream $releasever - BaseOS Debuginfo - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=CentOS Stream $releasever - BaseOS Source - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=CentOS Stream $releasever - AppStream - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[appstream-debuginfo]</span><br><span class="line">name=CentOS Stream $releasever - AppStream Debuginfo - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=CentOS Stream $releasever - AppStream Source - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="配置ip"><a class="markdownIt-Anchor" href="#配置ip"></a> 配置ip</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmcli connection modify &quot;ens160&quot; ipv4.method manual ipv4.addresses 192.168.213.110/24 ipv4.gateway 192.168.213.2 ipv4.dns &quot;192.168.213.2&quot;</span><br><span class="line">nmcli connection up &quot;ens160&quot;</span><br></pre></td></tr></table></figure><h3 id="安装k3s"><a class="markdownIt-Anchor" href="#安装k3s"></a> 安装k3s</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# curl -sfL https://get.k3s.io | sh</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s1.png" alt="k3s1" /></p><h3 id="查看k3s状态"><a class="markdownIt-Anchor" href="#查看k3s状态"></a> 查看k3s状态</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# systemctl status k3s</span><br><span class="line">[root@localhost ~]# kubectl get pod -A</span><br><span class="line">[root@localhost ~]# crictl image ls</span><br></pre></td></tr></table></figure><ul><li>由于下载的镜像网络原因，所以状态都是failed，需要修改镜像源加速</li></ul><h3 id="配置镜像源加速"><a class="markdownIt-Anchor" href="#配置镜像源加速"></a> 配置镜像源加速</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# cat &lt;&lt;EOF &gt; /etc/rancher/k3s/registries.yaml</span><br><span class="line">mirrors:</span><br><span class="line">  &quot;docker.io&quot;:</span><br><span class="line">    endpoint:</span><br><span class="line">      - &quot;https://docker.1ms.run&quot;</span><br><span class="line">      - &quot;https://docker-0.unsee.tech&quot;</span><br><span class="line">      - &quot;https://registry-1.docker.io&quot;</span><br><span class="line">  &quot;registry.k8s.io&quot;:</span><br><span class="line">    endpoint:</span><br><span class="line">      - &quot;https://k8s.m.daocloud.io&quot;</span><br><span class="line">EOF</span><br><span class="line">[root@localhost ~]# systemctl restart k3s</span><br><span class="line">[root@localhost ~]# systemctl status k3s</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s2.png" alt="k3s2" /></p><h3 id="通过k3s部署nginx进行测试"><a class="markdownIt-Anchor" href="#通过k3s部署nginx进行测试"></a> 通过k3s部署nginx进行测试</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# cat nginx.yaml</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 8081</span><br><span class="line">      targetPort: 80</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  type: LoadBalancer</span><br><span class="line">[root@localhost ~]# kubectl apply -f nginx.yaml</span><br><span class="line">[root@localhost ~]# kubectl get pods</span><br></pre></td></tr></table></figure><ul><li>当nginx部署成功后，通过如下进行访问</li></ul><h3 id="访问nginx服务"><a class="markdownIt-Anchor" href="#访问nginx服务"></a> 访问nginx服务</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# kubectl get svc</span><br><span class="line">NAME         TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)          AGE</span><br><span class="line">kubernetes   ClusterIP      10.43.0.1       &lt;none&gt;            443/TCP          18m</span><br><span class="line">nginx        LoadBalancer   10.43.179.184   192.168.213.110   8081:30768/TCP   56s</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s3.png" alt="k3s3" /></p><h3 id="设置k8s-config"><a class="markdownIt-Anchor" href="#设置k8s-config"></a> 设置k8s config</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# <span class="built_in">mkdir</span> -p ~/.kube</span><br><span class="line">[root@localhost ~]# <span class="built_in">cp</span> /etc/rancher/k3s/k3s.yaml ~/.kube/config</span><br><span class="line">[root@localhost ~]# <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) ~/.kube/config</span><br></pre></td></tr></table></figure><h3 id="安装helm"><a class="markdownIt-Anchor" href="#安装helm"></a> 安装helm</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 11929  100 11929    0     0  23810      0 --:--:-- --:--:-- --:--:-- 23810</span><br><span class="line">[WARNING] Could not find git. It is required <span class="keyword">for</span> plugin installation.</span><br><span class="line">Downloading https://get.helm.sh/helm-v3.19.4-linux-amd64.tar.gz</span><br><span class="line">Verifying checksum... Done.</span><br><span class="line">Preparing to install helm into /usr/local/bin</span><br><span class="line">helm installed into /usr/local/bin/helm</span><br></pre></td></tr></table></figure><h3 id="添加rancher-repo"><a class="markdownIt-Anchor" href="#添加rancher-repo"></a> 添加rancher repo</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</span><br><span class="line">[root@localhost ~]# kubectl create namespace cattle-system</span><br></pre></td></tr></table></figure><h3 id="安装cert-manager"><a class="markdownIt-Anchor" href="#安装cert-manager"></a> 安装cert-manager</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.11.0/cert-manager.crds.yaml</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/clusterissuers.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/challenges.acme.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/certificaterequests.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/issuers.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/certificates.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/orders.acme.cert-manager.io created</span><br><span class="line">[root@localhost ~]# kubectl create namespace cert-manager</span><br><span class="line">namespace/cert-manager created</span><br><span class="line">[root@localhost ~]# helm repo add jetstack https://charts.jetstack.io</span><br><span class="line"><span class="string">&quot;jetstack&quot;</span> has been added to your repositories</span><br><span class="line">[root@localhost ~]# helm repo update</span><br><span class="line">Hang tight <span class="keyword">while</span> we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the <span class="string">&quot;jetstack&quot;</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">&quot;rancher-stable&quot;</span> chart repository</span><br><span class="line">Update Complete. ⎈Happy Helming!⎈</span><br><span class="line">[root@localhost ~]# helm install cert-manager jetstack/cert-manager --namespace cert-manager --version v1.11.01</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s4.png" alt="k3s4" /></p><h3 id="安装rancher"><a class="markdownIt-Anchor" href="#安装rancher"></a> 安装rancher</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# helm install rancher rancher-stable/rancher   --namespace cattle-system   --<span class="built_in">set</span> hostname=rancher.kolukisa.org   --<span class="built_in">set</span> bootstrapPassword=admin   --<span class="built_in">set</span> ingress.tls.source=letsEncrypt   --<span class="built_in">set</span> letsEncrypt.email=mail@kolukisa.org  --<span class="built_in">set</span> replicas=1</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s5.png" alt="k3s5" /></p><ul><li>安装完成后如下</li></ul><p><img src="/img/article/k3s6.png" alt="k3s6" /></p><ul><li>将rancher的暴露方式修改为LoadBalancer</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl -n cattle-system edit svc rancher</span><br></pre></td></tr></table></figure><ul><li>将type: ClusterIP修改为LoadBalancer，将443端口修改为8443，port: 80修改为8080</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# kubectl -n cattle-system get svc</span><br><span class="line">NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                         AGE</span><br><span class="line">cm-acme-http-solver-jmrjt   NodePort       10.43.212.21    &lt;none&gt;            8089:31676/TCP                  12m</span><br><span class="line">imperative-api-extension    ClusterIP      10.43.131.234   &lt;none&gt;            6666/TCP                        11m</span><br><span class="line">rancher                     LoadBalancer   10.43.14.7      192.168.213.110   8080:31266/TCP,8443:32137/TCP   13m</span><br><span class="line">rancher-webhook             ClusterIP      10.43.215.43    &lt;none&gt;            443/TCP                         9m29s</span><br><span class="line">[root@localhost ~]# kubectl -n cattle-system get ingress</span><br><span class="line">NAME                        CLASS     HOSTS                  ADDRESS           PORTS     AGE</span><br><span class="line">cm-acme-http-solver-47h5w   traefik   rancher.kolukisa.org   192.168.213.110   80        12m</span><br><span class="line">rancher                     traefik   rancher.kolukisa.org   192.168.213.110   80, 443   13m</span><br></pre></td></tr></table></figure><h3 id="访问方式"><a class="markdownIt-Anchor" href="#访问方式"></a> 访问方式</h3><ul><li>通过ip+port访问</li></ul><p><img src="/img/article/k3s7.png" alt="k3s7" /></p><ul><li>通过域名访问</li></ul><p><img src="/img/article/k3s8.png" alt="k3s8" /></p>]]>
    </content>
    <id>https://jsonhc.github.io/posts/1243066710/</id>
    <link href="https://jsonhc.github.io/posts/1243066710/"/>
    <published>2026-02-25T16:00:00.000Z</published>
    <summary>
      <![CDATA[<h1 id="install-k3s-on-centos9"><a class="markdownIt-Anchor" href="#install-k3s-on-centos9"></a> install k3s on centos9</h1>
<h3 id="配置aliyu]]>
    </summary>
    <title>install k3s on centos9</title>
    <updated>2026-02-26T15:46:04.710Z</updated>
  </entry>
</feed>
