<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <author>
    <name>starttech</name>
  </author>
  <generator uri="https://hexo.io/">Hexo</generator>
  <id>https://jsonhc.github.io/</id>
  <link href="https://jsonhc.github.io/" rel="alternate"/>
  <link href="https://jsonhc.github.io/atom.xml" rel="self"/>
  <rights>All rights reserved 2026, starttech</rights>
  <subtitle>一起成长</subtitle>
  <title>starttech 的个人博客</title>
  <updated>2026-02-26T15:03:07.872Z</updated>
  <entry>
    <author>
      <name>starttech</name>
    </author>
    <category term="随笔" scheme="https://jsonhc.github.io/categories/%E9%9A%8F%E7%AC%94/"/>
    <category term="随笔" scheme="https://jsonhc.github.io/tags/%E9%9A%8F%E7%AC%94/"/>
    <content>
      <![CDATA[<h1 id="install-k3s-on-centos9"><a class="markdownIt-Anchor" href="#install-k3s-on-centos9"></a> install k3s on centos9</h1><h3 id="配置aliyun仓库"><a class="markdownIt-Anchor" href="#配置aliyun仓库"></a> 配置aliyun仓库</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tee /etc/yum.repos.d/centos.repo &gt; /dev/null &lt;&lt; &#x27;EOF&#x27;</span><br><span class="line">[baseos]</span><br><span class="line">name=CentOS Stream $releasever - BaseOS - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[baseos-debuginfo]</span><br><span class="line">name=CentOS Stream $releasever - BaseOS Debuginfo - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/x86_64/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[baseos-source]</span><br><span class="line">name=CentOS Stream $releasever - BaseOS Source - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/BaseOS/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[appstream]</span><br><span class="line">name=CentOS Stream $releasever - AppStream - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/os/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[appstream-debuginfo]</span><br><span class="line">name=CentOS Stream $releasever - AppStream Debuginfo - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/x86_64/debug/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">[appstream-source]</span><br><span class="line">name=CentOS Stream $releasever - AppStream Source - mirrors.aliyun.com</span><br><span class="line">baseurl=https://mirrors.aliyun.com/centos-stream/9-stream/AppStream/source/tree/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">enabled=0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="配置ip"><a class="markdownIt-Anchor" href="#配置ip"></a> 配置ip</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmcli connection modify &quot;ens160&quot; ipv4.method manual ipv4.addresses 192.168.213.110/24 ipv4.gateway 192.168.213.2 ipv4.dns &quot;192.168.213.2&quot;</span><br><span class="line">nmcli connection up &quot;ens160&quot;</span><br></pre></td></tr></table></figure><h3 id="安装k3s"><a class="markdownIt-Anchor" href="#安装k3s"></a> 安装k3s</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# curl -sfL https://get.k3s.io | sh</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s1.png" alt="k3s1" /></p><h3 id="查看k3s状态"><a class="markdownIt-Anchor" href="#查看k3s状态"></a> 查看k3s状态</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# systemctl status k3s</span><br><span class="line">[root@localhost ~]# kubectl get pod -A</span><br><span class="line">[root@localhost ~]# crictl image ls</span><br></pre></td></tr></table></figure><ul><li>由于下载的镜像网络原因，所以状态都是failed，需要修改镜像源加速</li></ul><h3 id="配置镜像源加速"><a class="markdownIt-Anchor" href="#配置镜像源加速"></a> 配置镜像源加速</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# cat &lt;&lt;EOF &gt; /etc/rancher/k3s/registries.yaml</span><br><span class="line">mirrors:</span><br><span class="line">  &quot;docker.io&quot;:</span><br><span class="line">    endpoint:</span><br><span class="line">      - &quot;https://docker.1ms.run&quot;</span><br><span class="line">      - &quot;https://docker-0.unsee.tech&quot;</span><br><span class="line">      - &quot;https://registry-1.docker.io&quot;</span><br><span class="line">  &quot;registry.k8s.io&quot;:</span><br><span class="line">    endpoint:</span><br><span class="line">      - &quot;https://k8s.m.daocloud.io&quot;</span><br><span class="line">EOF</span><br><span class="line">[root@localhost ~]# systemctl restart k3s</span><br><span class="line">[root@localhost ~]# systemctl status k3s</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s2.png" alt="k3s2" /></p><h3 id="通过k3s部署nginx进行测试"><a class="markdownIt-Anchor" href="#通过k3s部署nginx进行测试"></a> 通过k3s部署nginx进行测试</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# cat nginx.yaml</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 8081</span><br><span class="line">      targetPort: 80</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  type: LoadBalancer</span><br><span class="line">[root@localhost ~]# kubectl apply -f nginx.yaml</span><br><span class="line">[root@localhost ~]# kubectl get pods</span><br></pre></td></tr></table></figure><ul><li>当nginx部署成功后，通过如下进行访问</li></ul><h3 id="访问nginx服务"><a class="markdownIt-Anchor" href="#访问nginx服务"></a> 访问nginx服务</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# kubectl get svc</span><br><span class="line">NAME         TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)          AGE</span><br><span class="line">kubernetes   ClusterIP      10.43.0.1       &lt;none&gt;            443/TCP          18m</span><br><span class="line">nginx        LoadBalancer   10.43.179.184   192.168.213.110   8081:30768/TCP   56s</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s3.png" alt="k3s3" /></p><h3 id="设置k8s-config"><a class="markdownIt-Anchor" href="#设置k8s-config"></a> 设置k8s config</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# <span class="built_in">mkdir</span> -p ~/.kube</span><br><span class="line">[root@localhost ~]# <span class="built_in">cp</span> /etc/rancher/k3s/k3s.yaml ~/.kube/config</span><br><span class="line">[root@localhost ~]# <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) ~/.kube/config</span><br></pre></td></tr></table></figure><h3 id="安装helm"><a class="markdownIt-Anchor" href="#安装helm"></a> 安装helm</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 11929  100 11929    0     0  23810      0 --:--:-- --:--:-- --:--:-- 23810</span><br><span class="line">[WARNING] Could not find git. It is required <span class="keyword">for</span> plugin installation.</span><br><span class="line">Downloading https://get.helm.sh/helm-v3.19.4-linux-amd64.tar.gz</span><br><span class="line">Verifying checksum... Done.</span><br><span class="line">Preparing to install helm into /usr/local/bin</span><br><span class="line">helm installed into /usr/local/bin/helm</span><br></pre></td></tr></table></figure><h3 id="添加rancher-repo"><a class="markdownIt-Anchor" href="#添加rancher-repo"></a> 添加rancher repo</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</span><br><span class="line">[root@localhost ~]# kubectl create namespace cattle-system</span><br></pre></td></tr></table></figure><h3 id="安装cert-manager"><a class="markdownIt-Anchor" href="#安装cert-manager"></a> 安装cert-manager</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.11.0/cert-manager.crds.yaml</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/clusterissuers.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/challenges.acme.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/certificaterequests.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/issuers.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/certificates.cert-manager.io created</span><br><span class="line">customresourcedefinition.apiextensions.k8s.io/orders.acme.cert-manager.io created</span><br><span class="line">[root@localhost ~]# kubectl create namespace cert-manager</span><br><span class="line">namespace/cert-manager created</span><br><span class="line">[root@localhost ~]# helm repo add jetstack https://charts.jetstack.io</span><br><span class="line"><span class="string">&quot;jetstack&quot;</span> has been added to your repositories</span><br><span class="line">[root@localhost ~]# helm repo update</span><br><span class="line">Hang tight <span class="keyword">while</span> we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the <span class="string">&quot;jetstack&quot;</span> chart repository</span><br><span class="line">...Successfully got an update from the <span class="string">&quot;rancher-stable&quot;</span> chart repository</span><br><span class="line">Update Complete. ⎈Happy Helming!⎈</span><br><span class="line">[root@localhost ~]# helm install cert-manager jetstack/cert-manager --namespace cert-manager --version v1.11.01</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s4.png" alt="k3s4" /></p><h3 id="安装rancher"><a class="markdownIt-Anchor" href="#安装rancher"></a> 安装rancher</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# helm install rancher rancher-stable/rancher   --namespace cattle-system   --<span class="built_in">set</span> hostname=rancher.kolukisa.org   --<span class="built_in">set</span> bootstrapPassword=admin   --<span class="built_in">set</span> ingress.tls.source=letsEncrypt   --<span class="built_in">set</span> letsEncrypt.email=mail@kolukisa.org  --<span class="built_in">set</span> replicas=1</span><br></pre></td></tr></table></figure><p><img src="/img/article/k3s5.png" alt="k3s5" /></p><ul><li>安装完成后如下</li></ul><p><img src="/img/article/k3s6.png" alt="k3s6" /></p><ul><li>将rancher的暴露方式修改为LoadBalancer</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl -n cattle-system edit svc rancher</span><br></pre></td></tr></table></figure><ul><li>将type: ClusterIP修改为LoadBalancer，将443端口修改为8443，port: 80修改为8080</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# kubectl -n cattle-system get svc</span><br><span class="line">NAME                        TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)                         AGE</span><br><span class="line">cm-acme-http-solver-jmrjt   NodePort       10.43.212.21    &lt;none&gt;            8089:31676/TCP                  12m</span><br><span class="line">imperative-api-extension    ClusterIP      10.43.131.234   &lt;none&gt;            6666/TCP                        11m</span><br><span class="line">rancher                     LoadBalancer   10.43.14.7      192.168.213.110   8080:31266/TCP,8443:32137/TCP   13m</span><br><span class="line">rancher-webhook             ClusterIP      10.43.215.43    &lt;none&gt;            443/TCP                         9m29s</span><br><span class="line">[root@localhost ~]# kubectl -n cattle-system get ingress</span><br><span class="line">NAME                        CLASS     HOSTS                  ADDRESS           PORTS     AGE</span><br><span class="line">cm-acme-http-solver-47h5w   traefik   rancher.kolukisa.org   192.168.213.110   80        12m</span><br><span class="line">rancher                     traefik   rancher.kolukisa.org   192.168.213.110   80, 443   13m</span><br></pre></td></tr></table></figure><h3 id="访问方式"><a class="markdownIt-Anchor" href="#访问方式"></a> 访问方式</h3><ul><li>通过ip+port访问</li></ul><p><img src="/img/article/k3s7.png" alt="k3s7" /></p><ul><li>通过域名访问</li></ul><p><img src="/img/article/k3s8.png" alt="k3s8" /></p>]]>
    </content>
    <id>https://jsonhc.github.io/posts/1243066710/</id>
    <link href="https://jsonhc.github.io/posts/1243066710/"/>
    <published>2026-02-25T16:00:00.000Z</published>
    <summary>
      <![CDATA[<h1 id="install-k3s-on-centos9"><a class="markdownIt-Anchor" href="#install-k3s-on-centos9"></a> install k3s on centos9</h1>
<h3 id="配置aliyu]]>
    </summary>
    <title>install k3s on centos9</title>
    <updated>2026-02-26T15:03:07.872Z</updated>
  </entry>
</feed>
